From 5e960cfc2d820ff9af45b08371384d044d1bef83 Mon Sep 17 00:00:00 2001
From: Michal Brzozowski <miki@extremic.com>
Date: Wed, 9 Jul 2025 12:46:32 +0200
Subject: [PATCH] Fake ro.boot.flash.locked and ro.boot.verifiedbootstate to
 state that the bootloader is locked

Change-Id: I4ef121474ba57057f987260b94da30d5476b3beb
---
 libc/system_properties/system_properties.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/libc/system_properties/system_properties.cpp b/libc/system_properties/system_properties.cpp
index 886bef127..6be956746 100644
--- a/libc/system_properties/system_properties.cpp
+++ b/libc/system_properties/system_properties.cpp
@@ -322,6 +322,10 @@ void SystemProperties::ReadCallback(const prop_info* pi,
   // change.  We use relaxed memory order on the serial load for the same reason.
   if (is_read_only(pi->name)) {
     uint32_t serial = load_const_atomic(&pi->serial, memory_order_relaxed);
+    if (strcmp(pi->name, "ro.boot.flash.locked") == 0)
+	    callback(cookie, pi->name, "1", serial);
+    if (strcmp(pi->name, "ro.boot.verifiedbootstate") == 0)
+	    callback(cookie, pi->name, "green", serial);
     if (pi->is_long()) {
       callback(cookie, pi->name, pi->long_value(), serial);
     } else {
-- 
2.34.1

