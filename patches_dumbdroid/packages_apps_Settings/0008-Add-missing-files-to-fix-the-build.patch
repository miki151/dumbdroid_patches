From aeefe0d859bc8aae115cab17fe9ad3ff64493b5f Mon Sep 17 00:00:00 2001
From: Michal Brzozowski <miki@extremic.com>
Date: Sat, 29 Nov 2025 18:30:42 +0100
Subject: [PATCH 8/8] Add missing files to fix the build

Change-Id: Ie92c13384e9cace7e3d7c70fd6d31471499b0e24
---
 .../NumericKeyWakePreferenceController.kt     |  70 ++++++++++++
 .../android/settings/widget/AppBarUtils.java  |  55 ++++++++++
 .../widget/NonExpandableAppBarBehavior.java   | 100 ++++++++++++++++++
 3 files changed, 225 insertions(+)
 create mode 100644 src/com/android/settings/security/screenlock/NumericKeyWakePreferenceController.kt
 create mode 100644 src/com/android/settings/widget/AppBarUtils.java
 create mode 100644 src/com/android/settings/widget/NonExpandableAppBarBehavior.java

diff --git a/src/com/android/settings/security/screenlock/NumericKeyWakePreferenceController.kt b/src/com/android/settings/security/screenlock/NumericKeyWakePreferenceController.kt
new file mode 100644
index 00000000000..90a5e15c91a
--- /dev/null
+++ b/src/com/android/settings/security/screenlock/NumericKeyWakePreferenceController.kt
@@ -0,0 +1,70 @@
+/*
+ * Copyright (C) 2024 The LineageOS Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.settings.security.screenlock
+
+import android.content.Context
+import androidx.preference.Preference
+import androidx.preference.TwoStatePreference
+import com.android.internal.widget.LockPatternUtils
+import com.android.internal.widget.LockPatternUtils.CREDENTIAL_TYPE_PIN
+import com.android.settings.core.PreferenceControllerMixin
+import com.android.settingslib.core.AbstractPreferenceController
+import lineageos.providers.LineageSettings
+
+class NumericKeyWakePreferenceController(
+    context: Context,
+    private val userId: Int,
+    private val lockPatternUtils: LockPatternUtils
+) : AbstractPreferenceController(context), PreferenceControllerMixin,
+    Preference.OnPreferenceChangeListener {
+
+    companion object {
+        private const val PREF_KEY = "wake_on_numeric_key"
+        private const val SETTING_DEFAULT = 1
+    }
+
+    override fun isAvailable(): Boolean {
+        return lockPatternUtils.getCredentialTypeForUser(userId) == CREDENTIAL_TYPE_PIN
+    }
+
+    override fun getPreferenceKey(): String {
+        return PREF_KEY
+    }
+
+    override fun onPreferenceChange(preference: Preference, value: Any): Boolean {
+        LineageSettings.System.putIntForUser(
+            mContext.contentResolver,
+            LineageSettings.System.LOCKSCREEN_WAKE_ON_NUMERIC_KEY,
+            if (value as Boolean) 1 else 0,
+            userId
+        )
+        return true
+    }
+
+    override fun updateState(preference: Preference) {
+        (preference as TwoStatePreference).isChecked = isWakeOnNumericKeyEnabled()
+    }
+
+    private fun isWakeOnNumericKeyEnabled(): Boolean {
+        return LineageSettings.System.getIntForUser(
+            mContext.contentResolver,
+            LineageSettings.System.LOCKSCREEN_WAKE_ON_NUMERIC_KEY,
+            SETTING_DEFAULT,
+            userId
+        ) == 1
+    }
+}
diff --git a/src/com/android/settings/widget/AppBarUtils.java b/src/com/android/settings/widget/AppBarUtils.java
new file mode 100644
index 00000000000..d3a0b02466d
--- /dev/null
+++ b/src/com/android/settings/widget/AppBarUtils.java
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.settings.widget;
+
+import android.view.ViewGroup;
+
+import androidx.annotation.Nullable;
+import androidx.coordinatorlayout.widget.CoordinatorLayout;
+
+import com.google.android.material.appbar.AppBarLayout;
+
+/** Utility methods related to AppBarLayout behavior in Settings. */
+public final class AppBarUtils {
+
+    private AppBarUtils() {
+        // No instances.
+    }
+
+    /**
+     * Configures the {@link AppBarLayout} so that it always starts in a collapsed state and
+     * remains non-expandable during scrolling interactions.
+     */
+    public static void configureAppBarLayout(@Nullable AppBarLayout appBarLayout) {
+        if (appBarLayout == null) {
+            return;
+        }
+        final ViewGroup.LayoutParams layoutParams = appBarLayout.getLayoutParams();
+        if (layoutParams instanceof CoordinatorLayout.LayoutParams) {
+            final CoordinatorLayout.LayoutParams coordinatorLayoutParams =
+                    (CoordinatorLayout.LayoutParams) layoutParams;
+            coordinatorLayoutParams.setBehavior(new NonExpandableAppBarBehavior());
+            appBarLayout.setLayoutParams(coordinatorLayoutParams);
+        }
+        collapse(appBarLayout);
+    }
+
+    private static void collapse(AppBarLayout appBarLayout) {
+        appBarLayout.setExpanded(false /* expanded */, false /* animate */);
+        appBarLayout.post(() -> appBarLayout.setExpanded(false /* expanded */, false /* animate */));
+    }
+}
diff --git a/src/com/android/settings/widget/NonExpandableAppBarBehavior.java b/src/com/android/settings/widget/NonExpandableAppBarBehavior.java
new file mode 100644
index 00000000000..ad41457c342
--- /dev/null
+++ b/src/com/android/settings/widget/NonExpandableAppBarBehavior.java
@@ -0,0 +1,100 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.settings.widget;
+
+import android.view.View;
+
+import androidx.annotation.NonNull;
+import androidx.coordinatorlayout.widget.CoordinatorLayout;
+
+import com.google.android.material.appbar.AppBarLayout;
+
+/**
+ * {@link AppBarLayout.Behavior} that prevents the app bar from expanding via nested scrolls or
+ * drags, keeping the toolbar in its collapsed configuration.
+ */
+public class NonExpandableAppBarBehavior extends AppBarLayout.Behavior {
+
+    public NonExpandableAppBarBehavior() {
+        super();
+        setDragCallback(new AppBarLayout.Behavior.DragCallback() {
+            @Override
+            public boolean canDrag(@NonNull AppBarLayout appBarLayout) {
+                return false;
+            }
+        });
+    }
+
+    @Override
+    public void onNestedPreScroll(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, int dx, int dy,
+            @NonNull int[] consumed, int type) {
+        if (dy > 0) {
+            super.onNestedPreScroll(coordinatorLayout, child, target, dx, dy, consumed, type);
+        }
+    }
+
+    @Override
+    public void onNestedPreScroll(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, int dx, int dy,
+            @NonNull int[] consumed) {
+        if (dy > 0) {
+            super.onNestedPreScroll(coordinatorLayout, child, target, dx, dy, consumed);
+        }
+    }
+
+    @Override
+    public void onNestedScroll(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, int dxConsumed, int dyConsumed,
+            int dxUnconsumed, int dyUnconsumed, int type, @NonNull int[] consumed) {
+        if (dyUnconsumed >= 0) {
+            super.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed,
+                    dxUnconsumed, dyUnconsumed, type, consumed);
+        }
+    }
+
+    @Override
+    public void onNestedScroll(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, int dxConsumed, int dyConsumed,
+            int dxUnconsumed, int dyUnconsumed, int type) {
+        if (dyUnconsumed >= 0) {
+            super.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed,
+                    dxUnconsumed, dyUnconsumed, type);
+        }
+    }
+
+    @Override
+    public void onNestedScroll(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, int dxConsumed, int dyConsumed,
+            int dxUnconsumed, int dyUnconsumed) {
+        if (dyUnconsumed >= 0) {
+            super.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed,
+                    dxUnconsumed, dyUnconsumed);
+        }
+    }
+
+    @Override
+    public boolean onNestedFling(@NonNull CoordinatorLayout coordinatorLayout,
+            @NonNull AppBarLayout child, @NonNull View target, float velocityX, float velocityY,
+            boolean consumed) {
+        if (velocityY < 0) {
+            return false;
+        }
+        return super.onNestedFling(coordinatorLayout, child, target, velocityX, velocityY,
+                consumed);
+    }
+}
-- 
2.34.1

