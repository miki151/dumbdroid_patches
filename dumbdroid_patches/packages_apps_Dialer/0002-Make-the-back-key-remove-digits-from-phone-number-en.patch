From 01e27d6a079a5537c1c8ff6f51f49c054e451194 Mon Sep 17 00:00:00 2001
From: Michal Brzozowski <miki@extremic.com>
Date: Tue, 5 Aug 2025 17:20:21 +0200
Subject: [PATCH 2/2] Make the back key remove digits from phone number entry
 field

Change-Id: I560c04f58f9d70834602a639b4a1915d0a568393
---
 java/com/android/dialer/dialpadview/DialpadFragment.java  | 8 ++++++++
 .../android/dialer/main/impl/MainSearchController.java    | 3 ++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/java/com/android/dialer/dialpadview/DialpadFragment.java b/java/com/android/dialer/dialpadview/DialpadFragment.java
index 098735d8f..94ab7228c 100644
--- a/java/com/android/dialer/dialpadview/DialpadFragment.java
+++ b/java/com/android/dialer/dialpadview/DialpadFragment.java
@@ -1167,6 +1167,14 @@ public class DialpadFragment extends Fragment
     selectedAccount = null;
   }
 
+  public boolean removeLastDigit() {
+    if (!isDigitsEmpty()) {
+      keyPressed(KeyEvent.KEYCODE_DEL);
+      return true;
+    }
+    return false;
+  }
+
   private void handleDialButtonClickWithEmptyDigits() {
     if (phoneIsCdma() && isPhoneInUse()) {
       // TODO: Move this logic into services/Telephony
diff --git a/java/com/android/dialer/main/impl/MainSearchController.java b/java/com/android/dialer/main/impl/MainSearchController.java
index 2470ec029..82f3556bb 100644
--- a/java/com/android/dialer/main/impl/MainSearchController.java
+++ b/java/com/android/dialer/main/impl/MainSearchController.java
@@ -298,7 +298,8 @@ public class MainSearchController implements SearchBarListener {
   public boolean onBackPressed() {
     if (isDialpadVisible() && !TextUtils.isEmpty(dialpadFragment.getQuery())) {
       LogUtil.i("MainSearchController.onBackPressed", "Dialpad visible with query");
-      hideDialpad(/* animate=*/ true);
+      if (!dialpadFragment.removeLastDigit())
+        hideDialpad(/* animate=*/ true);
       return true;
     } else if (isSearchVisible()) {
       LogUtil.i("MainSearchController.onBackPressed", "Search is visible");
-- 
2.34.1

