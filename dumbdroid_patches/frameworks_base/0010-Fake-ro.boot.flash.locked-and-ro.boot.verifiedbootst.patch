From 855bdf5ae5c6e2d3015ce102017d9071c9d7b38a Mon Sep 17 00:00:00 2001
From: Michal Brzozowski <miki@extremic.com>
Date: Wed, 9 Jul 2025 12:47:38 +0200
Subject: [PATCH 10/44] Fake ro.boot.flash.locked and ro.boot.verifiedbootstate
 to state that the bootloader is locked

Change-Id: I10950d663dbb60eb108a7fb20be8b375e8ec7413
---
 core/jni/android_os_SystemProperties.cpp | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/core/jni/android_os_SystemProperties.cpp b/core/jni/android_os_SystemProperties.cpp
index 7f3b32e1abed..06c368a2254d 100644
--- a/core/jni/android_os_SystemProperties.cpp
+++ b/core/jni/android_os_SystemProperties.cpp
@@ -81,6 +81,18 @@ void ReadProperty(JNIEnv* env, jstring keyJ, Functor&& functor)
 jstring SystemProperties_getSS(JNIEnv* env, jclass clazz, jstring keyJ,
                                jstring defJ)
 {
+// ----- BEGIN BOOTLOADER-SPOOF PATCH -----
+    const char* key = env->GetStringUTFChars(keyJ, nullptr);
+    if (strcmp(key, "ro.boot.flash.locked") == 0) {
+        env->ReleaseStringUTFChars(keyJ, key);
+        return env->NewStringUTF("1");
+    }
+    if (strcmp(key, "ro.boot.verifiedbootstate") == 0) {
+        env->ReleaseStringUTFChars(keyJ, key);
+        return env->NewStringUTF("green");
+    }
+    env->ReleaseStringUTFChars(keyJ, key);
+    // ----- END BOOTLOADER-SPOOF PATCH -----
     jstring ret = defJ;
     ReadProperty(env, keyJ, [&](const char* value) {
         if (value[0]) {
-- 
2.34.1

